spring.application.name=interhubdev

# Server
server.port=8080

# Docker Compose (отключить если Docker не нужен или уже запущен вручную)
spring.docker.compose.enabled=false

# Database
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:interhubdev}
spring.datasource.username=${DB_USER:postgres}
spring.datasource.password=${DB_PASSWORD:root}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA / Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.open-in-view=false

# Flyway
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true

# JWT Authentication
jwt.secret=${JWT_SECRET:default-secret-key-for-development-only-change-in-production-min-32-chars}

# Access Token (short-lived, carried in cookie)
jwt.access.expiration=${JWT_ACCESS_EXPIRATION:900000}
jwt.access.cookie-name=access_token

# Refresh Token (long-lived, stored in DB)
jwt.refresh.expiration=${JWT_REFRESH_EXPIRATION:604800000}
jwt.refresh.cookie-name=refresh_token

# Cookie Security Settings
jwt.cookie.secure=${JWT_COOKIE_SECURE:false}
jwt.cookie.same-site=Strict
jwt.cookie.domain=${JWT_COOKIE_DOMAIN:}
jwt.cookie.path=/api

# Rate limit (general, per IP)
jwt.rate-limit.max-requests-per-second=${RATE_LIMIT_MAX_REQUESTS:50}
jwt.rate-limit.window-ms=${RATE_LIMIT_WINDOW_MS:1000}
jwt.rate-limit.cleanup-after-inactive-ms=${RATE_LIMIT_CLEANUP_MS:60000}

# Login rate limit (failed attempts per IP)
jwt.login-rate-limit.max-attempts=${LOGIN_RATE_LIMIT_MAX_ATTEMPTS:5}
jwt.login-rate-limit.window-minutes=${LOGIN_RATE_LIMIT_WINDOW_MINUTES:15}

# Security headers
jwt.security-headers.frame-options=${SECURITY_FRAME_OPTIONS:DENY}
jwt.security-headers.content-type-options=${SECURITY_CONTENT_TYPE_OPTIONS:nosniff}
jwt.security-headers.hsts-max-age-seconds=${SECURITY_HSTS_MAX_AGE:0}
jwt.security-headers.hsts-include-subdomains=${SECURITY_HSTS_INCLUDE_SUBDOMAINS:true}

# Proxy: set to true only when behind a trusted reverse proxy (e.g. nginx); then X-Forwarded-For is used for client IP
jwt.trust-proxy=${JWT_TRUST_PROXY:false}
# Base URL for password reset page (link in reset email)
jwt.password-reset-base-url=${JWT_PASSWORD_RESET_BASE_URL:http://localhost:5173}

# CORS: optional list of allowed origins (e.g. jwt.cors.allowed-origins[0]=https://app.example.com). Empty = same-origin only.

# Mail (Spring Mail / SMTP)
# Port 587 = STARTTLS (default). Port 465 = SSL: set MAIL_PORT=465, MAIL_USE_SSL=true, MAIL_USE_STARTTLS=false
spring.mail.host=${MAIL_HOST:smtp.gmail.com}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=${MAIL_USE_STARTTLS:true}
spring.mail.properties.mail.smtp.starttls.required=${MAIL_USE_STARTTLS:true}
spring.mail.properties.mail.smtp.ssl.enable=${MAIL_USE_SSL:false}
spring.mail.properties.mail.smtp.ssl.trust=${MAIL_HOST:smtp.gmail.com}
spring.mail.properties.mail.smtp.connectiontimeout=10000
spring.mail.properties.mail.smtp.timeout=10000

# Email Module Configuration
app.email.from=${MAIL_FROM:noreply@interhubdev.com}
app.email.from-name=${MAIL_FROM_NAME:InterHubDev}
app.email.enabled=${MAIL_ENABLED:true}
app.email.log-only=${MAIL_LOG_ONLY:false}
app.email.base-url=${APP_BASE_URL:http://localhost:3000}

# Actuator
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# OpenAPI / Swagger
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html

# Spring Modulith
spring.modulith.events.jdbc.schema-initialization.enabled=true

# Bootstrap SUPER_ADMIN (created on application startup)
# IMPORTANT: Set ADMIN_PASSWORD environment variable (min 8 chars) to enable bootstrap
app.admin.email=${ADMIN_EMAIL:admin@interhubdev.com}
app.admin.password=${ADMIN_PASSWORD:change-me-in-production-min-8-chars}
app.admin.first-name=${ADMIN_FIRST_NAME:Super}
app.admin.last-name=${ADMIN_LAST_NAME:Admin}

# Invitation Module Configuration
app.invitation.expiry-duration=${INVITATION_EXPIRY_DAYS:90d}
app.invitation.token-expiry-duration=${INVITATION_TOKEN_EXPIRY_HOURS:24h}
app.invitation.max-email-attempts=${INVITATION_MAX_EMAIL_ATTEMPTS:3}
app.invitation.retry-delay-seconds=${INVITATION_RETRY_DELAY:60}
app.invitation.base-url=${APP_BASE_URL:http://localhost:3000}

# MinIO / S3 Storage Configuration
app.storage.endpoint=${MINIO_ENDPOINT:http://localhost:9000}
app.storage.access-key=${MINIO_ACCESS_KEY:minioadmin}
app.storage.secret-key=${MINIO_SECRET_KEY:minioadmin}
app.storage.bucket-name=${MINIO_BUCKET_NAME:documents}
app.storage.region=${MINIO_REGION:us-east-1}
app.storage.preview-url-expires-seconds=${MINIO_PREVIEW_URL_EXPIRES_SECONDS:3600}

# Document module - file upload
spring.servlet.multipart.max-file-size=1GB
spring.servlet.multipart.max-request-size=1GB
app.document.max-file-size-bytes=${DOCUMENT_MAX_FILE_SIZE_BYTES:1073741824}
app.document.max-files-per-batch=${DOCUMENT_MAX_FILES_PER_BATCH:50}

# ClamAV (antivirus)
clamav.host=${CLAMAV_HOST:localhost}
clamav.port=${CLAMAV_PORT:3310}
clamav.timeout-ms=${CLAMAV_TIMEOUT_MS:30000}
clamav.enabled=${CLAMAV_ENABLED:false}

# Redis (used by OTP module and optional caching)
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.ssl.enabled=${REDIS_SSL_ENABLED:false}
spring.data.redis.timeout=5000

# OTP Module Configuration
app.otp.default-ttl-minutes=${OTP_DEFAULT_TTL_MINUTES:15}
app.otp.default-code-length=${OTP_DEFAULT_CODE_LENGTH:6}
app.otp.min-rate-limit-seconds=${OTP_MIN_RATE_LIMIT_SECONDS:60}
app.otp.max-verify-attempts=${OTP_MAX_VERIFY_ATTEMPTS:5}
app.otp.attempts-window-minutes=${OTP_ATTEMPTS_WINDOW_MINUTES:15}

# Outbox Module Configuration
outbox.processor.enabled=${OUTBOX_PROCESSOR_ENABLED:true}
outbox.processor.interval=${OUTBOX_PROCESSOR_INTERVAL:10000}
outbox.processor.batch-size=${OUTBOX_PROCESSOR_BATCH_SIZE:50}
outbox.processor.max-attempts=${OUTBOX_PROCESSOR_MAX_ATTEMPTS:10}
outbox.processor.base-retry-delay-seconds=${OUTBOX_PROCESSOR_BASE_RETRY_DELAY:30}
outbox.processor.max-retry-delay-seconds=${OUTBOX_PROCESSOR_MAX_RETRY_DELAY:1800}
outbox.processor.lock-stale-timeout-seconds=${OUTBOX_PROCESSOR_LOCK_STALE_TIMEOUT:300}
outbox.processor.worker-id=${OUTBOX_PROCESSOR_WORKER_ID:default}

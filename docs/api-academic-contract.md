# Контракт API: учебный календарь (академические годы и семестры)

Документ-контракт для фронтенда. Описаны эндпоинты модуля Academic: получение и управление академическими годами и семестрами (учебный календарь). Приведены структуры запросов и ответов, правила валидации и возможные ошибки.

---

## 1. Общие сведения

### 1.1 Базовый URL и префиксы

| Префикс | Назначение |
|---------|-------------|
| `/api` | Общий префикс REST API |
| `/api/academic` | Академические годы и семестры (учебный календарь) |

Хост и порт задаются окружением развёртывания. В описании ниже указаны только путь и query.

### 1.2 Авторизация

- Запросы выполняются с заголовком **`Authorization: Bearer <JWT>`** (токен выдаётся при входе).
- **Создание и обновление** (POST, PUT) академических годов и семестров доступны только ролям: **MODERATOR**, **ADMIN**, **SUPER_ADMIN**.
- **Удаление** (DELETE) доступно только ролям: **ADMIN**, **SUPER_ADMIN**.
- Эндпоинты чтения (GET) в данном документе не ограничены отдельной ролью; при необходимости уточните политику доступа в проекте.

### 1.3 Типы данных в ответах

- **UUID** — строка в формате UUID, например: `"550e8400-e29b-41d4-a716-446655440000"`.
- **Даты и время** — строки в формате **ISO-8601**: дата-время вида `"2025-02-05T12:00:00"`, дата вида `"2025-02-05"`.
- **Числа** — JSON number; для целых полей (номер семестра, количество недель) — целое число.
- **null** — явное отсутствие значения; поля могут не присутствовать в JSON или быть `null` в зависимости от контракта.

### 1.4 Формат ошибок

При ошибке (4xx, 5xx) сервер возвращает JSON-объект **ErrorResponse** (кроме части GET-эндпоинтов, где при 404 тело может быть пустым — см. разделы по эндпоинтам):

| Поле | Тип | Описание |
|------|-----|----------|
| `code` | string | Код ошибки (например, `BAD_REQUEST`, `NOT_FOUND`, `CONFLICT`, `VALIDATION_FAILED`, `UNAUTHORIZED`, `FORBIDDEN`) |
| `message` | string | Человекочитаемое сообщение |
| `timestamp` | string | Момент возникновения ошибки (ISO-8601, UTC) |
| `details` | object \| null | Опционально. Для ошибок валидации — объект «имя поля → сообщение»; иначе может отсутствовать |

Пример ответа с ошибкой валидации (400):

```json
{
  "code": "VALIDATION_FAILED",
  "message": "Ошибка проверки данных. Проверьте заполненные поля.",
  "timestamp": "2025-02-06T12:00:00.123Z",
  "details": {
    "name": "Name is required",
    "startDate": "Start date is required"
  }
}
```

Пример ответа «не найдено» (404) при вызове сервиса (например, обновление/удаление несуществующей сущности):

```json
{
  "code": "NOT_FOUND",
  "message": "Academic year not found: 550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2025-02-06T12:00:00.123Z",
  "details": null
}
```

---

## 2. Модели данных

### 2.1 AcademicYearDto

Используется во всех ответах, где возвращается академический год.

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | UUID | Уникальный идентификатор академического года |
| `name` | string | Название (например, «2024/2025») |
| `startDate` | string | Дата начала (ISO-8601, дата) |
| `endDate` | string | Дата окончания (ISO-8601, дата) |
| `isCurrent` | boolean | Признак текущего академического года (только один год может быть текущим) |
| `createdAt` | string | Дата и время создания записи (ISO-8601) |

### 2.2 SemesterDto

Используется во всех ответах, где возвращается семестр.

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | UUID | Уникальный идентификатор семестра |
| `academicYearId` | UUID | Id академического года |
| `number` | integer | Номер семестра (1, 2, …) |
| `name` | string \| null | Название семестра (опционально) |
| `startDate` | string | Дата начала (ISO-8601, дата) |
| `endDate` | string | Дата окончания (ISO-8601, дата) |
| `examStartDate` | string \| null | Дата начала экзаменационной сессии (ISO-8601) |
| `examEndDate` | string \| null | Дата окончания экзаменационной сессии (ISO-8601) |
| `weekCount` | integer | Количество учебных недель (1–52) |
| `isCurrent` | boolean | Признак текущего семестра (только один семестр может быть текущим) |
| `createdAt` | string | Дата и время создания записи (ISO-8601) |

---

## 3. Академические годы

### 3.1 GET /api/academic/years — список всех академических годов

**Назначение:** получение полного списка академических годов для выбора в UI (например, выпадающий список или календарь).

**Метод и путь:** `GET /api/academic/years`

**Права доступа:** ограничения по ролям в коде не заданы (доступно авторизованным пользователям).

**Параметры:** нет.

**Успешный ответ:** `200 OK`

Тело — массив объектов **AcademicYearDto**. Порядок: по дате начала по убыванию (`startDate` desc).

**Ошибки:** при невалидном или отсутствующем JWT — `401 Unauthorized` (код `UNAUTHORIZED`); при недостатке прав — `403 Forbidden` (код `FORBIDDEN`).

---

### 3.2 GET /api/academic/years/current — текущий академический год

**Назначение:** получение единственного академического года, помеченного как текущий (для отображения контекста «сейчас идёт этот год»).

**Метод и путь:** `GET /api/academic/years/current`

**Права доступа:** без отдельного ограничения по ролям.

**Параметры:** нет.

**Успешный ответ:** `200 OK` — один объект **AcademicYearDto**.

**Ошибки:** если текущий год не задан — `404 Not Found`; тело ответа может быть пустым (контроллер возвращает `ResponseEntity.notFound()`). При невалидном JWT — `401 Unauthorized`.

---

### 3.3 GET /api/academic/years/{id} — академический год по id

**Назначение:** получение одного академического года по идентификатору.

**Метод и путь:** `GET /api/academic/years/{id}`

**Параметр пути:** `id` — UUID академического года.

**Успешный ответ:** `200 OK` — один объект **AcademicYearDto**.

**Ошибки:** если год с указанным id не найден — `404 Not Found`; тело ответа может быть пустым. При невалидном JWT — `401 Unauthorized`.

---

### 3.4 POST /api/academic/years — создать академический год

**Назначение:** создание нового академического года (настройка учебного календаря).

**Метод и путь:** `POST /api/academic/years`

**Права доступа:** **MODERATOR**, **ADMIN**, **SUPER_ADMIN**.

**Body:** объект **CreateAcademicYearRequest**.

| Поле | Тип | Обязательность | Описание |
|------|-----|----------------|----------|
| `name` | string | да | Название года (не пустое после обрезки пробелов) |
| `startDate` | string (date) | да | Дата начала (ISO-8601) |
| `endDate` | string (date) | да | Дата окончания (ISO-8601) |
| `isCurrent` | boolean | нет | Если `true`, этот год помечается текущим; у ранее текущего флаг снимается |

**Успешный ответ:** `201 Created` — объект **AcademicYearDto**.

**Ошибки:**

| HTTP | code | Когда возникает |
|------|------|------------------|
| 400 | BAD_REQUEST | Не указано имя; не указаны даты; дата окончания не позже даты начала |
| 400 | VALIDATION_FAILED | Ошибка аннотационной валидации; в `details` — объект «поле → сообщение» |
| 401 | UNAUTHORIZED | Нет или невалидный JWT |
| 403 | FORBIDDEN | Нет роли MODERATOR/ADMIN/SUPER_ADMIN |
| 409 | CONFLICT | Академический год с таким именем уже существует (сообщение вида: «Academic year with name '…' already exists») |

---

### 3.5 PUT /api/academic/years/{id} — обновить академический год

**Назначение:** изменение названия, дат и/или признака «текущий» у существующего академического года.

**Метод и путь:** `PUT /api/academic/years/{id}`

**Права доступа:** **MODERATOR**, **ADMIN**, **SUPER_ADMIN**.

**Параметр пути:** `id` — UUID академического года.

**Body:** объект **UpdateAcademicYearRequest**. Все поля опциональны; передаются только изменяемые.

| Поле | Тип | Обязательность | Описание |
|------|-----|----------------|----------|
| `name` | string | нет | Название года |
| `startDate` | string (date) | нет | Дата начала |
| `endDate` | string (date) | нет | Дата окончания |
| `isCurrent` | boolean | нет | Если `true`, этот год помечается текущим; у ранее текущего флаг снимается |

**Успешный ответ:** `200 OK` — объект **AcademicYearDto**.

**Ошибки:**

| HTTP | code | Когда возникает |
|------|------|------------------|
| 400 | BAD_REQUEST | После обновления дата окончания не позже даты начала |
| 400 | VALIDATION_FAILED | Ошибка аннотационной валидации |
| 401 | UNAUTHORIZED | Нет или невалидный JWT |
| 403 | FORBIDDEN | Нет роли MODERATOR/ADMIN/SUPER_ADMIN |
| 404 | NOT_FOUND | Академический год с указанным id не найден (сообщение: «Academic year not found: &lt;id&gt;») |

---

### 3.6 DELETE /api/academic/years/{id} — удалить академический год

**Назначение:** удаление академического года из системы.

**Метод и путь:** `DELETE /api/academic/years/{id}`

**Права доступа:** **ADMIN**, **SUPER_ADMIN** (только эти роли).

**Параметр пути:** `id` — UUID академического года.

**Успешный ответ:** `204 No Content` — тело ответа пустое.

**Ошибки:**

| HTTP | code | Когда возникает |
|------|------|------------------|
| 401 | UNAUTHORIZED | Нет или невалидный JWT |
| 403 | FORBIDDEN | Нет роли ADMIN/SUPER_ADMIN |
| 404 | NOT_FOUND | Академический год с указанным id не найден |

---

## 4. Семестры

### 4.1 GET /api/academic/years/{academicYearId}/semesters — семестры по академическому году

**Назначение:** получение списка семестров выбранного академического года (например, для отображения семестров в календаре или выбора текущего семестра).

**Метод и путь:** `GET /api/academic/years/{academicYearId}/semesters`

**Параметр пути:** `academicYearId` — UUID академического года.

**Успешный ответ:** `200 OK` — массив объектов **SemesterDto**. Порядок: по полю `number` по возрастанию.

**Ошибки:** при невалидном JWT — `401 Unauthorized`. Примечание: при несуществующем `academicYearId` сервис возвращает пустой список (семестров для несуществующего года нет).

---

### 4.2 GET /api/academic/semesters/current — текущий семестр

**Назначение:** получение единственного семестра, помеченного как текущий.

**Метод и путь:** `GET /api/academic/semesters/current`

**Права доступа:** без отдельного ограничения по ролям.

**Параметры:** нет.

**Успешный ответ:** `200 OK` — один объект **SemesterDto**.

**Ошибки:** если текущий семестр не задан — `404 Not Found`; тело ответа может быть пустым. При невалидном JWT — `401 Unauthorized`.

---

### 4.3 GET /api/academic/semesters/{id} — семестр по id

**Назначение:** получение одного семестра по идентификатору.

**Метод и путь:** `GET /api/academic/semesters/{id}`

**Параметр пути:** `id` — UUID семестра.

**Успешный ответ:** `200 OK` — один объект **SemesterDto**.

**Ошибки:** если семестр с указанным id не найден — `404 Not Found`; тело ответа может быть пустым. При невалидном JWT — `401 Unauthorized`.

---

### 4.4 POST /api/academic/years/{academicYearId}/semesters — создать семестр

**Назначение:** создание нового семестра в рамках указанного академического года.

**Метод и путь:** `POST /api/academic/years/{academicYearId}/semesters`

**Права доступа:** **MODERATOR**, **ADMIN**, **SUPER_ADMIN**.

**Параметр пути:** `academicYearId` — UUID академического года.

**Body:** объект **CreateSemesterRequest**.

| Поле | Тип | Обязательность | Описание |
|------|-----|----------------|----------|
| `number` | integer | да | Номер семестра (≥ 1) |
| `name` | string | нет | Название семестра |
| `startDate` | string (date) | да | Дата начала семестра |
| `endDate` | string (date) | да | Дата окончания семестра |
| `examStartDate` | string (date) | нет | Дата начала экзаменов |
| `examEndDate` | string (date) | нет | Дата окончания экзаменов |
| `weekCount` | integer | нет | Количество учебных недель (1–52); по умолчанию 16 |
| `isCurrent` | boolean | нет | Если `true`, этот семестр помечается текущим; у ранее текущего флаг снимается |

**Успешный ответ:** `201 Created` — объект **SemesterDto**.

**Ошибки:**

| HTTP | code | Когда возникает |
|------|------|------------------|
| 400 | BAD_REQUEST | Не указан academic year id; не указаны даты; дата окончания не позже даты начала; номер семестра &lt; 1; weekCount не в диапазоне 1–52; дата начала семестра раньше даты начала академического года; дата окончания семестра позже даты окончания академического года |
| 400 | VALIDATION_FAILED | Ошибка аннотационной валидации; в `details` — объект «поле → сообщение» |
| 401 | UNAUTHORIZED | Нет или невалидный JWT |
| 403 | FORBIDDEN | Нет роли MODERATOR/ADMIN/SUPER_ADMIN |
| 404 | NOT_FOUND | Академический год с указанным `academicYearId` не найден (сообщение: «Academic year not found: &lt;id&gt;») |
| 409 | CONFLICT | Семестр с таким номером уже существует в этом академическом году (сообщение вида: «Semester N already exists for this academic year») |

---

### 4.5 PUT /api/academic/semesters/{id} — обновить семестр

**Назначение:** изменение названия, дат, количества недель и/или признака «текущий» у существующего семестра.

**Метод и путь:** `PUT /api/academic/semesters/{id}`

**Права доступа:** **MODERATOR**, **ADMIN**, **SUPER_ADMIN**.

**Параметр пути:** `id` — UUID семестра.

**Body:** объект **UpdateSemesterRequest**. Все поля опциональны.

| Поле | Тип | Обязательность | Описание |
|------|-----|----------------|----------|
| `name` | string | нет | Название семестра |
| `startDate` | string (date) | нет | Дата начала |
| `endDate` | string (date) | нет | Дата окончания |
| `examStartDate` | string (date) | нет | Дата начала экзаменов |
| `examEndDate` | string (date) | нет | Дата окончания экзаменов |
| `weekCount` | integer | нет | Количество учебных недель (1–52) |
| `isCurrent` | boolean | нет | Если `true`, этот семестр помечается текущим |

**Успешный ответ:** `200 OK` — объект **SemesterDto**.

**Ошибки:**

| HTTP | code | Когда возникает |
|------|------|------------------|
| 400 | BAD_REQUEST | После обновления дата окончания не позже даты начала; даты семестра выходят за границы академического года; weekCount не в диапазоне 1–52 |
| 400 | VALIDATION_FAILED | Ошибка аннотационной валидации (в т.ч. weekCount) |
| 401 | UNAUTHORIZED | Нет или невалидный JWT |
| 403 | FORBIDDEN | Нет роли MODERATOR/ADMIN/SUPER_ADMIN |
| 404 | NOT_FOUND | Семестр или связанный академический год не найдены (сообщения: «Semester not found: &lt;id&gt;», «Academic year not found: …») |

---

### 4.6 DELETE /api/academic/semesters/{id} — удалить семестр

**Назначение:** удаление семестра из системы.

**Метод и путь:** `DELETE /api/academic/semesters/{id}`

**Права доступа:** **ADMIN**, **SUPER_ADMIN**.

**Параметр пути:** `id` — UUID семестра.

**Успешный ответ:** `204 No Content` — тело ответа пустое.

**Ошибки:**

| HTTP | code | Когда возникает |
|------|------|------------------|
| 401 | UNAUTHORIZED | Нет или невалидный JWT |
| 403 | FORBIDDEN | Нет роли ADMIN/SUPER_ADMIN |
| 404 | NOT_FOUND | Семестр с указанным id не найден (сообщение: «Semester not found: &lt;id&gt;») |

---

## 5. Сводка кодов ошибок и HTTP-статусов

| HTTP | code | Когда возникает |
|------|------|------------------|
| 400 | BAD_REQUEST | Обязательные поля не указаны; дата окончания не позже даты начала; номер семестра &lt; 1; weekCount не в 1–52; даты семестра вне границ академического года |
| 400 | VALIDATION_FAILED | Ошибка аннотационной валидации запроса; в `details` — объект «поле → сообщение» |
| 401 | UNAUTHORIZED | Нет или невалидный JWT |
| 403 | FORBIDDEN | Недостаточно прав (для POST/PUT — нужны MODERATOR/ADMIN/SUPER_ADMIN; для DELETE — ADMIN/SUPER_ADMIN) |
| 404 | NOT_FOUND | Академический год или семестр не найдены (при GET по id/current тело ответа может быть пустым; при операциях через сервис — ErrorResponse с кодом NOT_FOUND) |
| 409 | CONFLICT | Академический год с таким именем уже существует; семестр с таким номером уже есть в данном академическом году |

---

## 6. Примеры запросов и ответов

### 6.1 GET /api/academic/years — ответ 200 (фрагмент)

**Запрос:** `GET /api/academic/years`

**Ответ 200 OK (сокращённо):**

```json
[
  {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "2024/2025",
    "startDate": "2024-09-01",
    "endDate": "2025-06-30",
    "isCurrent": true,
    "createdAt": "2024-08-15T10:00:00"
  },
  {
    "id": "660e8400-e29b-41d4-a716-446655440001",
    "name": "2023/2024",
    "startDate": "2023-09-01",
    "endDate": "2024-06-30",
    "isCurrent": false,
    "createdAt": "2023-08-01T09:00:00"
  }
]
```

---

### 6.2 POST /api/academic/years — создание года, ответ 201

**Запрос:** `POST /api/academic/years`

**Body:**

```json
{
  "name": "2025/2026",
  "startDate": "2025-09-01",
  "endDate": "2026-06-30",
  "isCurrent": false
}
```

**Ответ 201 Created:**

```json
{
  "id": "770e8400-e29b-41d4-a716-446655440002",
  "name": "2025/2026",
  "startDate": "2025-09-01",
  "endDate": "2026-06-30",
  "isCurrent": false,
  "createdAt": "2025-02-06T14:00:00"
}
```

---

### 6.3 POST /api/academic/years/{academicYearId}/semesters — создание семестра, ответ 201

**Запрос:** `POST /api/academic/years/550e8400-e29b-41d4-a716-446655440000/semesters`

**Body:**

```json
{
  "number": 1,
  "name": "Осенний семестр 2024",
  "startDate": "2024-09-01",
  "endDate": "2024-12-31",
  "examStartDate": "2025-01-10",
  "examEndDate": "2025-01-25",
  "weekCount": 16,
  "isCurrent": true
}
```

**Ответ 201 Created:**

```json
{
  "id": "880e8400-e29b-41d4-a716-446655440003",
  "academicYearId": "550e8400-e29b-41d4-a716-446655440000",
  "number": 1,
  "name": "Осенний семестр 2024",
  "startDate": "2024-09-01",
  "endDate": "2024-12-31",
  "examStartDate": "2025-01-10",
  "examEndDate": "2025-01-25",
  "weekCount": 16,
  "isCurrent": true,
  "createdAt": "2025-02-06T14:05:00"
}
```

---

### 6.4 Ошибка 409 CONFLICT — год с таким именем уже есть

**Запрос:** `POST /api/academic/years` с телом `{ "name": "2024/2025", "startDate": "2024-09-01", "endDate": "2025-06-30" }`

**Ответ 409 Conflict:**

```json
{
  "code": "CONFLICT",
  "message": "Academic year with name '2024/2025' already exists",
  "timestamp": "2025-02-06T14:10:00.000Z",
  "details": null
}
```

---

### 6.5 Ошибка 404 NOT_FOUND — академический год не найден (PUT)

**Запрос:** `PUT /api/academic/years/00000000-0000-0000-0000-000000000000`

**Ответ 404 Not Found:**

```json
{
  "code": "NOT_FOUND",
  "message": "Academic year not found: 00000000-0000-0000-0000-000000000000",
  "timestamp": "2025-02-06T14:12:00.000Z",
  "details": null
}
```
